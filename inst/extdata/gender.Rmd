---
title: "Gender preprocessing overview"
author: "`r author`"
date: "`r Sys.Date()`"
output: markdown_document
---

### Gender

 * [Author-gender mappings](output.tables/author_accepted.csv) in the final data

 * `r length(unique(subset(df.preprocessed, author_gender == "male")$author))` unique male authors
 
 * `r length(unique(subset(df.preprocessed, author_gender == "female")$author))` unique female authors
 
 * `r nrow(subset(df.preprocessed, author_gender == "male"))` documents (`r round(100*nrow(subset(df.preprocessed, author_gender == "male"))/nrow(df.preprocessed), 1)`%) with a male author
 
 * `r nrow(subset(df.preprocessed, author_gender == "female"))` documents (`r round(100*nrow(subset(df.preprocessed, author_gender == "female"))/nrow(df.preprocessed), 1)`%) with a female author
 
 * `r nrow(subset(df.preprocessed, author_gender == "ambiguous" | is.na(author_gender)))` documents (`r round(100*nrow(subset(df.preprocessed, author_gender == "ambiguous" | is.na(author_gender)))/nrow(df.preprocessed), 1)`%) with [unresolved gender](output.tables/author_gender_discarded.csv) (including pseudonymes)

 * [First names identified as female](output.tables/gender_female.csv) in the preprocessed data (including pseudonymes)

 * [First names identified as male](output.tables/gender_male.csv) in the preprocessed data (including pseudonymes)

 * [First names with ambiguous gender](output.tables/gender_ambiguous.csv) (both male and female listed in the gender mapping tables) in the preprocessed data (including pseudonymes)

 * [First names with unknown gender](output.tables/gender_unknown.csv) (no gender mapping info available) in the preprocessed data (including pseudonymes)


```{r summary-authorgenders, fig.height=7, fig.width=8, echo=FALSE, warning=FALSE, fig.show='hold', out.width='400px'}
gen <- df %>% select(author, author_gender)
dfs <- gen %>% group_by(author, author_gender) # %>% summarize(n = n())
dfs$author_gender <- as.character(dfs$author_gender)
dfs$author_gender[is.na(dfs$author_gender)] <- "unknown"
for (id in unique(dfs$author_gender)) {
  p <- top_plot(filter(dfs, author_gender == id), "author", ntop) + ggtitle(paste("Top", id, "authors"))
  print(p)
}
```


Author gender distribution in the complete data:

```{r summarygender0, echo=FALSE, message=FALSE, warning=FALSE}
dfs <- df %>% group_by(author_gender) %>%
              summarize(docs = n(), fraction = round(100*n()/nrow(df), 2))
names(dfs) <- c("Gender", "Documents (n)", "Fraction (%)")	      
kable(dfs, digit = 2)
```

Author gender distribution over time. Note that the name-gender mappings change over time and geography but this has not been taken into account here.


```{r summarygendertime, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=5}
tab <- table(df$author_gender)
dfd <- df %>% group_by(publication_decade) %>% summarize(n.male = sum(author_gender == "male", na.rm = T), n.female = sum(author_gender == "female", na.rm = T), n.total = n()) %>% mutate(p.male = 100*n.male/n.total, p.female = 100*n.female/n.total) %>% filter(n.total > 25 & publication_decade > 1470) 
dfy <- df %>% group_by(publication_year) %>% summarize(n.male = sum(author_gender == "male", na.rm = T), n.female = sum(author_gender == "female", na.rm = T), n.total = n()) %>% mutate(p.male = 100*n.male/n.total, p.female = 100*n.female/n.total) %>% filter(n.total > 25)
library(microbiome)
p <- NULL # Avoid confusion if the plot gives error
p <- microbiome::plot_regression(p.female ~ publication_decade, dfd, main = "Female authors proportion")
p <- p + ylab("Female authors (%)")
print(p)
```


