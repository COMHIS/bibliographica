---
title: "Publication place preprocessing summary"
author: "`r author`"
date: "`r Sys.Date()`"
output: markdown_document
---

### Publication places

 * `r length(unique(str_trim(unlist(strsplit(as.character(df$publication_place), ";")))))` [unique accepted publication places](output.tables/publication_place_accepted.csv)
 * Publication place is identified for `r sum(!is.na(df$publication_place))` documents (`r round(100*mean(!is.na(df$publication_place)))`%). 
 * Publication country is identified for `r sum(!is.na(df$country))` documents (`r round(100*mean(!is.na(df$country)))`%). [List of places with unknown publication country](output.tables/publication_place_missingcountry.csv) (add to [country mappings](https://github.com/rOpenGov/bibliographica/blob/master/inst/extdata/reg2country.csv))
 * We have `r length(unique(df$country))` [unique accepted publication countries](output.tables/country_accepted.csv)
 * `r round(100*mean(!is.na(df$latitude) & !is.na(df$longitude)), 1)`% of the documents could be matched to geographic coordinates (based on the [Geonames](http://download.geonames.org/export/dump/) database). See the [list of places missing geocoordinate information](output.tables/absentgeocoordinates.csv). Altogether ```r round(100 * mean(is.na(df.preprocessed$latitude) | is.na(df.preprocessed$longitude)), 2)```% of the documents have missing geocoordinates.
 * [Non-trivial conversions from the original to final place names](output.tables/publication_place_conversion_nontrivial.csv)
 * [Ambiguous publication places](output.tables/publication_place_ambiguous.csv)
 * [Potentially ambiguous region-country mappings](output.tables/publication_country_ambiguous.csv) (the default country is listed first)
 * [Discarded publication places](output.tables/publication_place_discarded.csv) (add to [synonyme list](https://github.com/rOpenGov/bibliographica/blob/master/inst/extdata/PublicationPlaceSynonymes.csv) to accept; or add to [publication place stopwords](https://github.com/rOpenGov/bibliographica/blob/master/inst/extdata/stopwords_for_place.csv) to completely discard the term)

Top-`r ntop` publication places are shown together with the number of documents.

```{r summaryplace, echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, fig.height=4, fig.show='hold', out.width='430px'}
p <- top_plot(df, "publication_place", ntop)
p <- p + ggtitle(paste("Top publication places"))
p <- p + scale_y_log10()
p <- p + ylab("Title count")
print(p)

p <- top_plot(df, "country", ntop)
p <- p + ggtitle(paste("Top publication countries"))
p <- p + scale_y_log10()
p <- p + ylab("Title count")
print(p)
```


```{r summaryplace3, echo=FALSE, results='asis'}
pubc <- top(df, "country", output = "data.frame")
kable(head(pubc), caption = "Top publication country counts", digits = 2)
```
